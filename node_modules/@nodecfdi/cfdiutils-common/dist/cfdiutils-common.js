var l=class extends Error{constructor(e){super(`No ${e} was provided.`),this.name=`${e}NotFoundError`}};var w,C,x,I=()=>{if(!C)throw new l("DOMParser");return C},y=()=>{if(!x)throw new l("XMLSerializer");return x},E=()=>{if(!w)throw new l("DOMImplementation");return w},A=(n,e,t)=>{C=n,x=e,w=t};var u={isElement(n){return!!(n&&n.nodeType===n.ELEMENT_NODE)},isAttr(n){return!!(n&&n.nodeType===n.ATTRIBUTE_NODE)},isText(n){return!!(n&&n.nodeType===n.TEXT_NODE)},isDocument(n){return!!(n&&n.nodeType===n.DOCUMENT_NODE)}};var c={documentElement(n){if(!u.isElement(n.documentElement))throw new SyntaxError("Document does not have root element");return n.documentElement},ownerDocument(n){if(!n.ownerDocument){if(u.isDocument(n))return n;throw new TypeError("node.ownerDocument is undefined but node is not a Document")}return n.ownerDocument},newDocument(n){return n||(n=E().createDocument(null,null,null)),n},newDocumentContent(n){if(n==="")throw new SyntaxError("Received xml string argument is empty");let e=I();try{let t=e.parseFromString(n,"text/xml");if(t.getElementsByTagName("parsererror").length>0)throw new Error("Error parsing XML");return c.newDocument(t)}catch(t){throw new SyntaxError(`Cannot create a Document from xml string, errors: ${JSON.stringify(t)}`)}},isValidXmlName(n){return n===""?!1:/^[\p{L}_:][\p{L}\d_:.-]*$/u.test(n)},createElement(n,e,t=""){return c.createDOMElement(()=>{if(!e)throw new SyntaxError("Empty Name");return n.createElement(e)},`Cannot create element with name ${e}`,t)},createDOMElement(n,e,t){let r,i;try{r=n()}catch(o){i=o}if(!r||!u.isElement(r))throw new SyntaxError(`${e} on ${i?i.message:"not is element"}`);return t!==""&&r.appendChild(c.ownerDocument(r).createTextNode(t)),r}};var f=class n extends Map{constructor(e={}){super(),this.importRecord(e)}static castValueToString(e,t){if(t!=null){if(/boolean|number|string/.test(typeof t))return`${t}`;if(typeof t=="object"&&!Array.isArray(t))return t.toString();throw new SyntaxError(`Cannot convert value of attribute ${e} to string`)}}get(e){let t=super.get(e);return t===void 0?"":t}set(e,t){if(t==null)return this.delete(e),this;if(!c.isValidXmlName(e))throw new SyntaxError(`Cannot set attribute with an invalid xml name: ${e}`);return super.set(e,t.toString()),this}exists(e){let t=!1;for(let r of this.keys())if(e===r){t=!0;break}return t}importRecord(e){if(Object.keys(e).length>0)for(let[t,r]of Object.entries(e)){let i=n.castValueToString(t,r);this.set(t,i)}return this}exportRecord(){let e={};for(let[t,r]of this.entries())e[t]=r;return e}offsetExists(e){return this.exists(e)}offsetGet(e){return this.get(e)}offsetSet(e,t){this.set(e,n.castValueToString(e,t))}offsetUnset(e){super.delete(e)}};var p=class n{_order=new Map;size;constructor(e=[]){this.setOrder(e)}static compareMaps(e,t){let r;if(e.size!==t.size)return!1;for(let[i,o]of e)if(r=t.get(i),r!==o||r===void 0&&!t.has(i))return!1;return!0}setOrder(e){let t=new Map(Array.from(this.parseNames(e),r=>[r[1],r[0]]));return n.compareMaps(this._order,t)?!1:(this._order=t,this.size=t.size,!0)}parseNames(e){let t=r=>!!r&&typeof r=="string"&&r!=="0";return new Map([...new Set(e.filter(r=>t(r)))].map((r,i)=>[i,r]))}getOrder(){return[...new Map(Array.from(this._order,t=>[t[1],t[0]])).values()]}sort(e){return this.size>0&&(e=this.stableArraySort(e,"compareNodesByName")),e}compareNodesByName(e,t){let r=this.valueByName(e.name()),i=this.valueByName(t.name());return Math.sign(r-i)}valueByName(e){return this._order.get(e)??this.size}stableArraySort(e,t){let r=e.map((o,m)=>({item:o,index:m})),i=(o,m)=>{let N=this[t](o.item,m.item);return N===0&&(N=Math.sign(o.index-m.index)),N};return r=r.sort(i),r.map(o=>o.item)}};var d=class n extends Array{_sorter;constructor(e=[]){super(),this._sorter=new p,this.importFromArray(e)}static get[Symbol.species](){return Array}add(...e){let t=!1;for(let r of e)this.exists(r)||(this.push(r),t=!0);return t&&this.order(),this}order(){this.splice(0,this.length,...this._sorter.sort(this))}setOrder(e){this._sorter.setOrder(e)&&this.order()}getOrder(){return this._sorter.getOrder()}remove(e){let t=this.indexOf(e);return t>=0&&this.splice(t,1),this}removeAll(){return this.splice(0,this.length),this}exists(e){return this.includes(e)}first(){return this.at(0)}get(e){let r=[...this.values()].at(e);if(!r)throw new RangeError(`The index ${e} does not exists`);return r}firstNodeWithName(e){return this.find(t=>t.name()===e)}getNodesByName(e){let t=new n;for(let r of this)r.name()===e&&t.add(r);return t}importFromArray(e){for(let[t,r]of e.entries())if(typeof r.searchNodes!="function"||typeof r.children!="function")throw new SyntaxError(`The element index ${t} is not a CNodeInterface object`);return this.add(...e),this}};var h=class{_name;_attributes;_children;_value;constructor(e,t={},r=[],i=""){if(!c.isValidXmlName(e))throw new SyntaxError(`Cannot create a node with an invalid xml name: ${e}`);this._name=e,this._attributes=new f(t),this._children=new d(r),this._value=i}name(){return this._name}children(){return this._children}addChild(e){return this._children.add(e),e}attributes(){return this._attributes}clear(){this._attributes.clear(),this._children.removeAll()}addAttributes(e){this._attributes.importRecord(e)}value(){return this._value}setValue(e){this._value=e}searchAttribute(...e){let t=e.pop(),r=this.searchNode(...e);return!r||!t?"":r.attributes().get(t)||""}searchNodes(...e){let t=new d,r=e.pop(),i=this.searchNode(...e);if(i)for(let o of i.children())o.name()===r&&t.add(o);return t}searchNode(...e){let t=this;for(let r of e)if(t=t.children().firstNodeWithName(r),!t)break;return t}offsetExists(e){return this.attributes().offsetExists(e)}get(e){return this.attributes().offsetGet(e)}set(e,t){this.attributes().offsetSet(e,t)}unset(e){this.attributes().offsetUnset(e)}count(){return this.children().length}[Symbol.iterator](){return this._children[Symbol.iterator]()}};var g=class{export(e){let t=c.newDocument(),r=this.exportRecursive(t,e);return t.appendChild(r),r}exportRecursive(e,t){let r=e.createElement(t.name());for(let[i,o]of t.attributes().entries())r.setAttribute(i,o);for(let i of t.children()){let o=this.exportRecursive(e,i);r.appendChild(o)}return this.isCNodeHasValueInterface(t)&&t.value()!==""&&r.appendChild(e.createTextNode(t.value())),r}isCNodeHasValueInterface(e){return typeof e.value=="function"&&typeof e.setValue=="function"}};var b=class{registeredNamespaces={};import(e){let t=new h(e.tagName);t.setValue(this.extractValue(e)),e.prefix&&e.prefix!==""&&(this.registerNamespace(t,`xmlns:${e.prefix}`,e.namespaceURI),this.registerNamespace(t,"xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"));for(let r of Array.from(e.attributes))t.attributes().set(r.name,r.value);e.hasAttributeNS("http://www.w3.org/2000/xmlns/","")&&t.attributes().set("xmlns",e.getAttributeNS("http://www.w3.org/2000/xmlns/",""));for(let r of Array.from(e.childNodes)){if(!u.isElement(r))continue;let i=this.import(r);t.children().add(i)}return t}registerNamespace(e,t,r){this.registeredNamespaces[t]||(this.registeredNamespaces[t]=r,e.attributes().set(t,r))}extractValue(e){let t=[];for(let r of Array.from(e.childNodes))u.isText(r)&&t.push(r.data);return t.join("")}};var v={nodeToXmlElement(n){return new g().export(n)},nodeToXmlString(n,e=!1){let t=v.nodeToXmlElement(n);if(e){let r=t.ownerDocument,i=r.createProcessingInstruction("xml",'version="1.0" encoding="UTF-8"');return r.insertBefore(i,r.firstChild),y().serializeToString(r)}return y().serializeToString(t.ownerDocument)},nodeFromXmlElement(n){return new b().import(n)},nodeFromXmlString(n){return v.nodeFromXmlElement(c.documentElement(c.newDocumentContent(n)))}};var D=class n{_currency;_decimals;constructor(e,t){if(!/^[A-Z]{3}$/.test(e))throw new Error("Property currency is not valid");if(t<0)throw new Error("Property decimals cannot be less than zero");this._currency=e,this._decimals=Math.floor(t)}static decimalsCount(e){let t=e.split("."),r=t.length>1?t.at(-1):void 0;return r?r.length:0}static newFromKnownCurrencies(e,t){let r=n.knownCurrencyDecimals(e);if(r<0){if(!t)throw new RangeError(`The currency ${e} is not known`);r=t}return new n(e,r)}static knownCurrencyDecimals(e){return{MXN:2,EUR:2,USD:2,XXX:0}[e]||-1}currency(){return this._currency}decimals(){return this._decimals}round(e){return Number.parseFloat(e.toFixed(this.decimals()))}doesNotExceedDecimals(e){return n.decimalsCount(e)<=this.decimals()}};export{f as CAttributes,h as CNode,d as CNodes,p as CNodesSorter,D as CurrencyDecimals,l as DOMNotFoundError,u as DomValidators,c as Xml,v as XmlNodeUtils,E as getDom,I as getParser,y as getSerializer,A as install};
/* istanbul ignore else -- @preserve */
/* istanbul ignore next -- @preserve */
/* istanbul ignore if -- @preserve Hard of test */
//# sourceMappingURL=cfdiutils-common.js.map